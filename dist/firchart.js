(()=>{function e(e){return function(e){if(Array.isArray(e))return r(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||n(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function t(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,a,i,o,l=[],c=!0,s=!1;try{if(i=(n=n.call(e)).next,0===t){if(Object(n)!==n)return;c=!1}else for(;!(c=(r=i.call(n)).done)&&(l.push(r.value),l.length!==t);c=!0);}catch(e){s=!0,a=e}finally{try{if(!c&&null!=n.return&&(o=n.return(),Object(o)!==o))return}finally{if(s)throw a}}return l}}(e,t)||n(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function n(e,t){if(e){if("string"==typeof e)return r(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?r(e,t):void 0}}function r(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function a(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function i(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?a(Object(n),!0).forEach((function(t){var r,a,i;r=e,a=t,i=n[t],(a=s(a))in r?Object.defineProperty(r,a,{value:i,enumerable:!0,configurable:!0,writable:!0}):r[a]=i})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):a(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function l(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,s(r.key),r)}}function c(e,t,n){return t&&l(e.prototype,t),n&&l(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}function s(e){var t=function(e,t){if("object"!=u(e)||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,"string");if("object"!=u(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==u(t)?t:String(t)}function u(e){return u="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},u(e)}function d(e,t,n){for(var r=0,a=0;a<t;a++){if(null==e[a][n])return;r+=e[a][n]}return r/t}function f(e,t,n){if(!(e.length<t)){for(var r=2/(t+1),a=e[0][n],i=1;i<t;i++){if(null==e[i][n])return;a=e[i][n]*r+a*(1-r)}return a}}function m(e,t){return t?Math.max(e.high-e.low,Math.abs(e.high-t),Math.abs(e.low-t)):e.high-e.low}function h(e,t){for(var n=0,r=null,a=0;a<t;a++){var i=m(e[a],r);a<t?n+=i:n=(n*(t-1)+i)/t,r=e[a].close}return n/t}function p(e,t,n){for(var r=0,a=0,i=0;i<t-1;i++){var o=e[i][n]-e[i+1][n];o>=0?r+=o:a-=o}return 100-100/(1+r/t/(a/t))}window.FirChart=function(n,r,a){var l={sma:{name:function(e){return"SMA (".concat(e.options.length,")")},type:"line",options:{color:"#1111AA",length:20},fn:function(e,t){return y(d(e,t.length,"close"))}},ema:{name:function(e){return"EMA (".concat(e.options.length,")")},type:"line",options:{color:"#AA1111",length:20},fn:function(e,t){return y(f(e,t.length,"close"))}},atr:{name:function(e){return"ATR (".concat(e.options.length,")")},type:"line",separatePane:!0,options:{color:"#11AA11",length:14},fn:function(e,t){return y(h(e,t.length))}},keltnerChannels:{name:function(){return"KC"},type:"band",numLines:3,options:{color:"#11AA11",emaLength:20,multiplier:2,atrLength:10},fn:function(e,t){var n=f(e,t.emaLength,"close"),r=h(e,t.atrLength);return[y(n+r*t.multiplier),y(n),y(n-r*t.multiplier)]}},bollingerBands:{name:function(){return"BB"},type:"band",numLines:3,options:{color:"#1A1AA1",smaLength:20,stdev:2},fn:function(e,t){var n=d(e,t.smaLength,"close"),r=function(e,t,n){for(var r=d(e,t,n),a=0,i=0;i<t;i++)a+=Math.pow(e[i][n]-r,2);return Math.sqrt(a/t)}(e,t.smaLength,"close");return[y(n+r*t.stdev),y(n),y(n-r*t.stdev)]}},rsi:{name:function(e){return"RSI (".concat(e.options.length,")")},type:"band",separatePane:!0,numLines:3,options:{color:"#A1A11A",length:14,upperLevel:70,lowerLevel:30},fn:function(e,t){return[t.upperLevel,y(p(e,t.length,"close")),t.lowerLevel]}}};function s(e){if(null===e||"object"!==u(e))return e;if(e instanceof Date)return new Date(e.getTime());if(Array.isArray(e)){for(var t=[],n=0;n<e.length;n++)t[n]=s(e[n]);return t}if(e instanceof Object){var r={};for(var a in e)e.hasOwnProperty(a)&&(r[a]=s(e[a]));return r}return e}function m(e){for(var t="",n=0;n<e;n++)t+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789".charAt(Math.floor(62*Math.random()));return"x"+t}function v(e){return[parseInt(e.slice(1,3),16)/255,parseInt(e.slice(3,5),16)/255,parseInt(e.slice(5,7),16)/255,1]}function y(e){return Math.round(100*e)/100}function g(e,t){var n=e.indexOf(t);n>-1&&e.splice(n,1)}var b,x=function(){function e(t){o(this,e),this.storageKey=t,this.loadInitialState()}return c(e,[{key:"loadInitialState",value:function(){var e=localStorage.getItem(this.storageKey);this.state=e?JSON.parse(e):{}}},{key:"set",value:function(e,t){this.state[e]=t,this.saveState()}},{key:"setProperty",value:function(e,t,n){var r=this.state[e];null==r&&(r={}),r[t]=n,this.state[e]=r,this.saveState()}},{key:"setObject",value:function(e,t){for(var n=e.split("."),r=this.state;n.length>1;){var a=n.shift();r[a]=r[a]||{},r=r[a]}r[n[0]]=i(i({},r[n[0]]),t),this.saveState()}},{key:"get",value:function(e){return this.state[e]}},{key:"getProperty",value:function(e,t){return this.state[e]&&this.state[e][t]}},{key:"forEach",value:function(e){for(var t in this.state)this.state.hasOwnProperty(t)&&e(t,this.state[t])}},{key:"remove",value:function(e){e in this.state&&(delete this.state[e],this.saveState())}},{key:"saveState",value:function(){localStorage.setItem(this.storageKey,JSON.stringify(this.state))}}]),e}(),w=function(){function e(){o(this,e)}return c(e,[{key:"set",value:function(){}},{key:"setProperty",value:function(){}},{key:"setObject",value:function(){}},{key:"get",value:function(){}},{key:"getProperty",value:function(){}},{key:"forEach",value:function(){}},{key:"remove",value:function(){}}]),e}();b=a.persistIndicatorState?new x("indicator-settings"):new w;var L='<?xml version="1.0" encoding="UTF-8"?><svg width="24px" height="24px" viewBox="0 0 24 24" stroke-width="1.5" fill="none" xmlns="http://www.w3.org/2000/svg" color="#000000"><path d="M3 13C6.6 5 17.4 5 21 13" stroke="#000000" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"></path><path d="M12 17C10.3431 17 9 15.6569 9 14C9 12.3431 10.3431 11 12 11C13.6569 11 15 12.3431 15 14C15 15.6569 13.6569 17 12 17Z" stroke="#000000" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"></path></svg>',C='<?xml version="1.0" encoding="UTF-8"?><svg width="24px" height="24px" stroke-width="1.5" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" color="#000000"><path d="M6.75827 17.2426L12.0009 12M17.2435 6.75736L12.0009 12M12.0009 12L6.75827 6.75736M12.0009 12L17.2435 17.2426" stroke="#000000" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"></path></svg>',k='<?xml version="1.0" encoding="UTF-8"?><svg width="24px" height="24px" stroke-width="1.5" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" color="#000000"><path d="M12 15C13.6569 15 15 13.6569 15 12C15 10.3431 13.6569 9 12 9C10.3431 9 9 10.3431 9 12C9 13.6569 10.3431 15 12 15Z" stroke="#000000" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"></path><path d="M19.6224 10.3954L18.5247 7.7448L20 6L18 4L16.2647 5.48295L13.5578 4.36974L12.9353 2H10.981L10.3491 4.40113L7.70441 5.51596L6 4L4 6L5.45337 7.78885L4.3725 10.4463L2 11V13L4.40111 13.6555L5.51575 16.2997L4 18L6 20L7.79116 18.5403L10.397 19.6123L11 22H13L13.6045 19.6132L16.2551 18.5155C16.6969 18.8313 18 20 18 20L20 18L18.5159 16.2494L19.6139 13.598L21.9999 12.9772L22 11L19.6224 10.3954Z" stroke="#000000" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"></path></svg>',M='<?xml version="1.0" encoding="UTF-8"?><svg width="24px" height="24px" stroke-width="1.5" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" color="#000000"><path d="M6 9L12 15L18 9" stroke="#000000" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"></path></svg>',E='<?xml version="1.0" encoding="UTF-8"?><svg width="24px" height="24px" viewBox="0 0 24 24" stroke-width="1.5" fill="none" xmlns="http://www.w3.org/2000/svg" color="#000000"><path d="M14.3632 5.65156L15.8431 4.17157C16.6242 3.39052 17.8905 3.39052 18.6716 4.17157L20.0858 5.58579C20.8668 6.36683 20.8668 7.63316 20.0858 8.41421L18.6058 9.8942M14.3632 5.65156L4.74749 15.2672C4.41542 15.5993 4.21079 16.0376 4.16947 16.5054L3.92738 19.2459C3.87261 19.8659 4.39148 20.3848 5.0115 20.33L7.75191 20.0879C8.21972 20.0466 8.65806 19.8419 8.99013 19.5099L18.6058 9.8942M14.3632 5.65156L18.6058 9.8942" stroke="#000000" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"></path></svg>',S=function(e,t){return function(n,r){var a=v(e.bull);a[3]=t;var i=v(e.bear);i[3]=t,fc.webglFillColor().value((function(e){return e.close>=e.open?a:i})).data(r)(n)}};function P(e){return e.each((function(){var e=d3.select(this);e.style("display","grid"),e.style("display","-ms-grid"),e.style("grid-template-columns","minmax(0em,max-content) 0fr 1fr 0fr minmax(0em,max-content)"),e.style("-ms-grid-columns","minmax(0em,max-content) 0fr 1fr 0fr minmax(0em,max-content)"),e.style("grid-template-rows","minmax(0em,max-content) 0fr 1fr 0fr minmax(0em,max-content)"),e.style("-ms-grid-rows","minmax(0em,max-content) 0fr 1fr 0fr minmax(0em,max-content)")}))}function O(e){return e.each((function(){var e=d3.select(this);e.style("grid-template-rows","minmax(0em, max-content) 0fr 0fr 0fr minmax(0em, max-content)"),e.style("-ms-grid-rows","minmax(0em, 0em) 0fr 0fr 0fr minmax(0em, 0em)")}))}function A(e,t){return function(n){return n.each((function(){d3.select(this).style(e,t)}))}}var j=A("display","none"),T=A("display","block");function N(e){d3.selectAll("".concat(e," .plot-area")).call(j),d3.selectAll("".concat(e," .cartesian-chart")).call(O),d3.selectAll("".concat(e)).call(A("flex","0"))}function D(e){d3.selectAll("".concat(e," .plot-area")).call(T),d3.selectAll("".concat(e," .cartesian-chart")).call(P),d3.selectAll("".concat(e)).call(A("flex","1"))}function I(e,t,n){return new Proxy(e,{get:function(e,r){if("string"==typeof r&&!isNaN(r)){var a=n[t-Number(r)];return null==a?{}:a}return e[r]}})}function B(e,t){var n=document.createElement("div");n.style.position="absolute",n.style.backgroundColor="rgba(238, 238, 238, 0.5)",n.style.width="100%",n.style.height="100%",n.style.display="none",n.style.userSelect="none",n.style.zIndex="1",n.onclick=function(e){e.target===n&&(n.style.display="none")};var r=document.createElement("div");r.style.width="400px",r.style.margin="100px auto",r.style.backgroundColor="#fff",r.style.position="relative",r.style.padding="15px",r.style.boxShadow="0px 0px 10px rgba(0,0,0,0.5)";var a=document.createElement("div");a.innerHTML=e,a.style.fontSize="1.5rem",a.style.padding="5px";var i=document.createElement("div"),o=document.createElement("div");return o.innerHTML=C,o.style.position="absolute",o.style.top="20px",o.style.right="15px",o.style.cursor="pointer",o.onclick=function(){n.style.display="none"},r.appendChild(a),r.appendChild(o),r.appendChild(i),n.appendChild(r),t.appendChild(n),[n,i,function(){n.style.display="block"},function(e){a.innerHTML=e}]}var V=r.map((function(e,t,n){return I(e,t,n)})),H="cursor",W="placeLineInitial",z="placeLineSecondary",F="dragLine",Y={mode:H,currentBar:null,volumeVisible:!0,indicators:[],additionalPanes:[],currentPaneId:"#ohlc-chart",drawings:[]},R=[];R.push((function(e){return Y.currentBar=e}));var X={x:-1,y:-1};function U(e){if(Y.mode=e,e===W||e===z)return Y.activeDrag&&Y.activeDrag.drawing.stopMoving(),d3.select("#ohlc-chart").node().style.cursor='url("'.concat((t=E.replace(/"/g,"'").replace(/%/g,"%25").replace(/#/g,"%23").replace(/{/g,"%7B").replace(/}/g,"%7D").replace(/</g,"%3C").replace(/>/g,"%3E"),"data:image/svg+xml,".concat(t)),'") 0 24, pointer'),d3.select("#volume-chart").node().style.cursor="not-allowed",void Y.additionalPanes.forEach((function(e){var t=e.id;d3.select(t).node().style.cursor="not-allowed"}));var t;je(),e!==F?(je(),d3.select("#ohlc-chart").node().style.cursor="default",d3.select("#volume-chart").node().style.cursor="default",Y.additionalPanes.forEach((function(e){var t=e.id;d3.select(t).node().style.cursor="default"}))):d3.select("#ohlc-chart").node().style.cursor="grabbing"}var q=document.createElement("style");q.type="text/css",q.innerHTML=".info-box-hover-effect:hover { background-color: rgba(0, 0, 0, 0.1); }",document.getElementsByTagName("head")[0].appendChild(q);var K=document.getElementById(n);K.style.display="flex",K.style.flexDirection="column",K.style.fontSize="1.2em";var Z=document.createElement("div");Z.id="ohlc-chart",Z.style.flex=4,K.appendChild(Z);var J=document.createElement("div");J.id="volume-chart",J.style.flex=1,K.appendChild(J);var G=document.createElement("div");G.id="info-box",G.style.position="absolute",G.style.padding="0.4em 0.6em 0.4em 0.4em",G.style.backgroundColor="#eee",G.style.userSelect="none",G.style.width="24rem",G.style.fontSize="0.9rem",G.style.zIndex="1",K.appendChild(G);var _=document.createElement("div");_.style.display="flex",_.style.alignItems="center";var Q=document.createElement("div");Q.style.padding="0.3em";var $={open:document.createElement("span"),high:document.createElement("span"),low:document.createElement("span"),close:document.createElement("span")};R.push((function(e){$.open.innerHTML=y(e.open),$.high.innerHTML=y(e.high),$.low.innerHTML=y(e.low),$.close.innerHTML=y(e.close)}));var ee=document.createElement("span");ee.innerHTML="O: ";var te=document.createElement("span");te.innerHTML=" H: ";var ne=document.createElement("span");ne.innerHTML=" L: ";var re=document.createElement("span");re.innerHTML=" C: ",$.open.style.fontWeight="bold",$.high.style.fontWeight="bold",$.low.style.fontWeight="bold",$.close.style.fontWeight="bold",Q.appendChild(ee),Q.appendChild($.open),Q.appendChild(te),Q.appendChild($.high),Q.appendChild(ne),Q.appendChild($.low),Q.appendChild(re),Q.appendChild($.close);var ae=document.createElement("div"),ie=document.createElement("div");ie.style.flex="1",ie.style.cursor="pointer",ie.style.textAlign="right",ie.style.display="flex",ie.style.justifyContent="flex-end",ie.innerHTML=M;var oe=!0,le=function(){oe=!oe,b.setProperty("ohlcBox","toggled",oe),oe?(ie.innerHTML=M,ae.style.display="block"):(ie.innerHTML='<?xml version="1.0" encoding="UTF-8"?><svg width="24px" height="24px" stroke-width="1.5" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" color="#000000"><path d="M6 15L12 9L18 15" stroke="#000000" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"></path></svg>',ae.style.display="none")};function ce(e,n,r,a){var i,o=document.createElement("div");i=e.id?e.id:m(8),o.id=i+"-info",e.state&&(e.state.elementId=i),o.style.paddingLeft="0.3em",o.style.display="flex",o.style.alignItems="center";var l,c=document.createElement("span");c.className="label","function"==typeof e.name?l=e.name(e):"string"==typeof e.name&&(l=e.name),c.innerHTML=l,o.appendChild(c);var s=document.createElement("span");s.style.fontWeight="bold",s.style.marginLeft="0.3em",o.appendChild(s);var u=document.createElement("span");u.style.flex="1",u.style.textAlign="right",u.style.marginLeft="1em",u.style.display="flex",u.style.justifyContent="flex-end",o.appendChild(u);var d=document.createElement("span");d.innerHTML=L,d.style.paddingLeft=".1em",d.style.cursor="pointer",u.appendChild(d),ae.insertBefore(o,ae.children[ae.children.length-1]);var f,h=!0,p=null!=e.iName||"volume"===e.id,v=function(){n(),h=!h,p&&b.setProperty(i,"toggled",h),o.style.opacity=h?1:.5};d.addEventListener("click",(function(){v(),Ge()})),p&&!1===b.getProperty(i,"toggled")&&v(),r&&(f={onValueChange:function(e){var t=r(e);Array.isArray(t)&&!t.some(isNaN)?s.innerHTML=t.join(","):isNaN(t)?s.innerHTML="...":s.innerHTML=""+t}},infoBoxItems.push(f));var y=function(){};if(a){var x=document.createElement("span");x.innerHTML=C,x.style.paddingLeft=".1em",x.style.cursor="pointer",u.appendChild(x);var w=document.createElement("span");w.innerHTML=k,w.style.cursor="pointer",u.insertBefore(w,d);var M=t(B(l,K),4),E=M[0],S=M[1],P=M[2],O=M[3];!function(t,n,r){var a=document.createElement("form");function i(){for(var t={},n=0;n<a.elements.length;n++){var r=a.elements[n];if(r.name){var i=r.value;"number"===r.type&&(i=Number(i)),t[r.name]=i}}var o;o=t,e.options=o,e.refreshOptions(),function(e){var t=document.getElementById(e.state.elementId);if(t)for(var n=0;n<t.children.length;n++)"label"===t.children[n].className&&(t.children[n].innerHTML=e.name(e))}(e),Ge()}for(var o in a.style.textAlign="left",a.style.marginTop="1em",a.style.fontSize="1rem",n)if(n.hasOwnProperty(o)){var l=document.createElement("div");l.style.marginBottom="10px",l.style.marginLeft="0.5em";var c=document.createElement("label");c.textContent=o+": ",c.style.marginRight="10px",c.style.display="inline-block",c.style.width="100px";var s=document.createElement("input");s.name=o,s.value=n[o];var u=function(){s.style.padding="0.1rem 0.2rem 0.1em 0.2em",s.style.border="1px solid gray",s.style.borderRadius="3px"};"string"==typeof n[o]?n[o].startsWith("#")?s.type="color":(u(),s.type="text"):"number"==typeof n[o]&&(u(),s.type="number"),s.addEventListener("blur",i),l.appendChild(c),l.appendChild(s),a.appendChild(l)}t.appendChild(a)}(S,e.options),w.addEventListener("click",(function(){"function"==typeof e.name&&O(e.name(e)),P()})),y=function(){o.remove(),E.remove(),f&&g(infoBoxItems,f),a&&a()},x.addEventListener("click",y)}return{remove:y}}ie.onclick=le,!1===b.getProperty("ohlcBox","toggled")&&le(),_.appendChild(Q),_.appendChild(ie),G.appendChild(_),G.appendChild(ae),infoBoxItems=[],R.push((function(e){return infoBoxItems.forEach((function(t){return t.onValueChange(e)}))}));var se=document.createElement("div");se.style.display="flex",se.style.padding="0.4em",ae.appendChild(se);var ue=document.createElement("div");ue.innerHTML="Add Indicator",ue.style.textDecoration="underline",ue.style.cursor="pointer",se.appendChild(ue);var de=document.createElement("div");de.innerHTML="Add Line",de.style.textDecoration="underline",de.style.cursor="pointer",de.style.marginLeft="1em",se.appendChild(de),de.addEventListener("click",(function(){U(W)})),ce({name:function(){return"Volume"},id:"volume"},(function(){return Y.volumeVisible=!Y.volumeVisible}),(function(e){return y(e.volume)}));var fe=fc.scaleDiscontinuous(d3.scaleTime()).domain(fc.extentDate().accessors([function(e){return e.date}])(V)),me=d3.scaleLinear().domain(fc.extentLinear().accessors([function(e){return e.high+(e.high-e.low)/3},function(e){return e.low-(e.high-e.low)/3}])(V)),he=function(){return function(e){if(e.length<2)return 0;for(var t=Number.MAX_SAFE_INTEGER,n=1;n<e.length;n++)Math.abs(e[n]-e[n-1])<t&&(t=Math.abs(e[n]-e[n-1]));return t}(V.map((function(e){return e.date.getTime()})))},pe=function(){if(V.length>1){for(var e,t=he(),n=[],r=1;r<V.length;r++)V[r].date.getTime()-V[r-1].date.getTime()>t&&n.push([V[r-1].date,new Date(V[r].date.getTime()-t)]);fe.discontinuityProvider((e=fc).discontinuityRange.apply(e,n))}},ve=function(){if(0!==V.length){var e=new Date(V[V.length-1].date.getTime()+he()),t=V[0].date;V.length>100&&(t=V[V.length-100].date),pe(),fe.domain([t,e])}};ve();var ye=function(){if(0!==V.length){var t=V.filter((function(e){return fe(e.date)>=0&&fe(e.date)<=d3.select("#ohlc-chart").node().clientWidth})),n=Math.min.apply(Math,e(t.map((function(e){return e.low})))),r=Math.max.apply(Math,e(t.map((function(e){return e.high}))));Y.indicators.forEach((function(a){if(!a.separatePane&&a.state.enabled){var i=t.map(a.fn).filter((function(e){return!isNaN(e)}));Math.min.apply(Math,e(i))<n&&(n=Math.min.apply(Math,e(i))),Math.max.apply(Math,e(i))>r&&(r=Math.max.apply(Math,e(i)))}})),n-=((r+=(r-n)/10)-n)/10,me.domain([n,r])}},ge=fc.zoom().duration(0).scaleExtent([.3,5]).on("zoom",(function(e){X.x=e.sourceEvent.layerX,ye(),Y.textDrawings.forEach((function(e){var t=e.x,n=e.y,r=e.elem;r.setAttributeNS(null,"x",fe(t)),r.setAttributeNS(null,"y",me(n))})),Ge()})),be=fc.annotationSvgCrosshair().xScale(fe).yScale(me).xLabel((function(e){return""})).yLabel((function(e){return""})).decorate((function(e){e.enter().selectAll("g.annotation-line > line").each((function(){var e=d3.select(this);e.style("stroke-opacity",".8"),e.style("stroke-dasharray","4")}))}));function xe(){var e="#volume-chart";Y.additionalPanes.forEach((function(t){var n=t.id;document.querySelector("".concat(e," d3fc-svg.x-axis.bottom-axis")).style.display="none",e=n})),document.querySelector("".concat(e," d3fc-svg.x-axis.bottom-axis")).style.display="block"}function we(t){var n=t.type,r=t.options,a=t.fn;t.fn=function(e){if(e)return a(e,t.options)},t.state={enabled:!0,chartObjects:{}};var i=t.id;i||(i=m(8)),b.setProperty(i,"id",i),b.setProperty(i,"iName",t.iName);var o,l,c,s=ze;if(t.separatePane){d3.select("#x-label").remove(),t.state.newPaneElem=document.createElement("div"),t.state.newPaneElem.id=i,t.state.newPaneElem.style.flex=1,K.appendChild(t.state.newPaneElem);var u="#"+t.state.newPaneElem.id;s=fc.seriesWebglMulti(),l=d3.scaleLinear(),t.refreshDomain=function(){var r;if("line"===n){var a=V.map((function(e){return t.fn(e)})).filter((function(e){return!isNaN(e)}));r=[.95*Math.min.apply(Math,e(a)),1.05*Math.max.apply(Math,e(a))]}else if("band"===n){var i=V.map((function(e){return t.fn(e)})).flat().filter((function(e){return!isNaN(e)}));r=[.95*Math.min.apply(Math,e(i)),1.05*Math.max.apply(Math,e(i))]}l.domain(r)},t.refreshDomain();var d=Y.additionalPanes.length,f=fc.chartCartesian({xScale:fe,yScale:l,yAxis:{right:function(e){return fc.axisRight(e).ticks(3)}}}).webglPlotArea(s).svgPlotArea(Be).decorate((function(e){e.enter().call(P),e.enter().selectAll(".plot-area").call(ge,fe),e.enter().selectAll(".x-axis").call(ge,fe),e.enter().selectAll(".top-label").call(j),e.enter().selectAll("svg").call(A("font-size","14px")),e.on("mousemove",(function(e){Je(u),Ze(e);var t=me.range()[0]+Ve.range()[0];Y.additionalPanes.forEach((function(e,n){e.id!==u&&n<d&&(t+=e.yScale.range()[0])})),X.y=e.layerY;var n=l.range()[0];e.layerY>n&&(X.y=n),X.y+=t,qe()}))}));o={id:u,chart:f,yScale:l},Y.additionalPanes.push(o)}if(t.enableSeparatePane=function(){t.separatePane&&D(o.id)},t.disableSeparatePane=function(){t.separatePane&&N(o.id)},t.removeSeparatePane=function(){t.separatePane&&(g(Y.additionalPanes,o),xe(),t.state.newPaneElem.remove())},"line"===n){var h=fc.seriesWebglLine().xScale(fe).yScale(me).crossValue((function(e){return e.date})).mainValue(t.fn).decorate(fc.webglStrokeColor(v(r.color)));t.state.chartObjects.line=h,c=function(){if(t.separatePane){var n=V.map((function(e){return t.fn(e)})).filter((function(e){return!isNaN(e)}));l.domain([.95*Math.min.apply(Math,e(n)),1.05*Math.max.apply(Math,e(n))])}t.state.chartObjects.line.decorate(fc.webglStrokeColor(v(t.options.color)))},t.disable=function(){t.state.chartObjects.line.mainValue((function(e){}))},t.enable=function(){t.state.chartObjects.line.mainValue(t.fn)},t.remove=function(){Ye(s,t.state.chartObjects.line)},Fe(s,t.state.chartObjects.line)}else if("band"===n){for(var p=[],y=t.numLines,x=function(e){var n=fc.seriesWebglLine().crossValue((function(e){return e.date})).mainValue((function(n){var r=t.fn(n);if(r)return r[e]})).decorate(fc.webglStrokeColor(v(r.color)));p.push(n),Fe(s,n)},w=0;w<y;w++)x(w);t.state.chartObjects.lines=p,c=function(){if(t.separatePane){var n=V.map((function(e){return t.fn(e)})).flat().filter((function(e){return!isNaN(e)}));l.domain([.95*Math.min.apply(Math,e(n)),1.05*Math.max.apply(Math,e(n))])}t.state.chartObjects.lines.forEach((function(e){return e.decorate(fc.webglStrokeColor(v(t.options.color)))}))},t.disable=function(){t.state.chartObjects.lines.forEach((function(e){return e.mainValue((function(e){}))}))},t.enable=function(){t.state.chartObjects.lines.forEach((function(e,n){return e.mainValue((function(e){var r=t.fn(e);if(r)return r[n]}))}))},t.remove=function(){t.state.chartObjects.lines.forEach((function(e){return Ye(s,e)}))}}t.refreshOptions=function(){b.setObject(t.id+".options",t.options),c()},Y.indicators.push(t),ce(t,(function(){t.state.enabled=!t.state.enabled,b.setProperty(t.id,"toggled",t.state.enabled),t.state.enabled?(t.enable(),t.enableSeparatePane()):(t.disable(),t.disableSeparatePane()),ye()}),(function(e){return t.fn(e)}),(function(){b.remove(t.id),g(Y.indicators,t),t.removeSeparatePane(),t.remove()})),xe()}var Le=t(B("Add Indicator",K),3),Ce=(Le[0],Le[1]),ke=Le[2];Ce.style.marginTop="1em",a.indicators.forEach((function(e){var t=l[e],n=document.createElement("div");n.className="info-box-hover-effect",n.innerHTML=t.name(t),n.style.marginTop="0.2em",n.style.cursor="pointer",n.style.padding="5px",n.style.fontSize="1rem",n.addEventListener("click",(function(){var n=s(t);n.iName=e;var r=n.name;n.name=function(e){return r(e)+": "},we(n)})),Ce.appendChild(n)})),ue.addEventListener("click",ke);var Me="#7733dd",Ee=fc.seriesSvgMulti(),Se=864e5;function Pe(e,t){return function(n){var r=(t-n.date)/Se;if(r>-1&&r<0)return t;var a=(e-n.date)/Se;return a>0&&a<1||a>-1&&a<0?e:e<=t&&n.date>=e&&n.date<=t||t<e&&n.date>=t&&n.date<=e?n.date:void 0}}function Oe(e,t,n,r){var a=(r-t)/(n-e);if(!isNaN(a))return function(i){var o=(n-i.date)/Se;if(o>-1&&o<0)return r;var l=(e-i.date)/Se;return l>0&&l<1||l>-1&&l<0?t:t+(i.date.getTime()-e.getTime())*a}}function Ae(e,t){if(null!=Y.activeLine&&null!=Y.activeLine.chartObject){var n=Y.activeLine.x1,r=Y.activeLine.y1,a=fe.invert(e),i=me.invert(t);Y.activeLine.chartObject.crossValue(Pe(n,a)).mainValue(Oe(n,r,a,i)),Ge()}}function je(){null!=Y.activeLine&&(null!=Y.activeLine.chartObject&&Ye(Ee,Y.activeLine.chartObject),Y.activeLine=null)}function Te(e,t){U(F),Y.activeDrag={initialX:e.layerX,initialY:e.layerY,drawing:t}}function Ne(){Y.activeDrag&&Y.activeDrag.drawing.stopMoving(),U(H)}function De(e,t,n,r,a){var o,l=arguments.length>5&&void 0!==arguments[5]?arguments[5]:{},c={name:e,color:null!==(o=l.color)&&void 0!==o?o:Me};""===e&&(c.name="New Line");var s={name:function(e){return e.options.name},options:c,state:{enabled:!0,initialCoords:{x1:t,y1:n,x2:r,y2:a}},moreOpts:l},u=function(e){Y.mode===F?Ne():Te(e,s),Ge()},d=m(8),f=function(e){e.attr("id",d),e.attr("stroke",s.options.color),l.draggable&&(Y.mode===F?e.style("cursor","grabbing"):e.style("cursor","grab"),e.on("click",u))},h=fc.seriesSvgLine().xScale(fe).yScale(me).crossValue(Pe(t,r)).mainValue(Oe(t,n,r,a)).decorate(f);l.draggable&&(s.shadowChartObject=fc.seriesSvgLine().xScale(fe).yScale(me).crossValue(Pe(t,r)).mainValue(Oe(t,n,r,a)).decorate((function(e){e.attr("id",d+"-shadow"),e.attr("stroke-width",15),e.attr("stroke-opacity",0),Y.mode===F?e.style("cursor","grabbing"):e.style("cursor","grab"),e.on("click",u)})),Fe(Ee,s.shadowChartObject)),s.move=function(e,t){s.state.inProgressCoords={x1:fe.invert(e+fe(s.state.initialCoords.x1)),x2:fe.invert(e+fe(s.state.initialCoords.x2)),y1:me.invert(t+me(s.state.initialCoords.y1)),y2:me.invert(t+me(s.state.initialCoords.y2))};var n=s.state.inProgressCoords,r=n.x1,a=n.y1,i=n.x2,o=n.y2;[s.chartObject,s.shadowChartObject].forEach((function(e){return e.crossValue(Pe(r,i)).mainValue(Oe(r,a,i,o))})),Ge()},s.stopMoving=function(){s.state.initialCoords=i({},s.state.inProgressCoords);var e=s.state.initialCoords,t=e.x1,n=e.y1,r=e.x2,a=e.y2;[s.chartObject,s.shadowChartObject].forEach((function(e){return e.crossValue(Pe(t,r)).mainValue(Oe(t,n,r,a))})),Ge()},s.id=d,s.chartObject=h,Y.drawings.push(s),s.disable=function(){h.mainValue((function(e){})),s.shadowChartObject&&s.shadowChartObject.mainValue((function(e){}))},s.enable=function(){var e=s.state.initialCoords,t=e.x1,n=e.y1,r=e.x2,a=e.y2;h.mainValue(Oe(t,n,r,a)),s.shadowChartObject&&s.shadowChartObject.mainValue(Oe(t,n,r,a))},s.refreshOptions=function(){h.decorate(f)},Fe(Ee,h);var p=function(){Ye(Ee,s.chartObject),s.shadowChartObject&&Ye(Ee,s.shadowChartObject),g(Y.drawings,s)},v=p;return l.hideFromInfoBox||(v=ce(s,(function(){s.state.enabled=!s.state.enabled,s.state.enabled?s.enable():s.disable()}),null,p).remove),{remove:v}}Y.textDrawings=[];var Ie=fc.autoBandwidth(fc.seriesWebglCandlestick()).decorate(S(a.colors,1)),Be=fc.seriesSvgLine(),Ve=d3.scaleLinear(),He=function(){var t=V.map((function(e){return e.volume})),n=Math.max.apply(Math,e(t)),r=Math.min.apply(Math,e(t));Ve.domain([r/1.3,n])};He();var We=fc.autoBandwidth(fc.seriesWebglBar()).crossValue((function(e){return e.date})).mainValue((function(e){return e.volume})).decorate(S(a.colors,.8)),ze=fc.seriesWebglMulti();function Fe(t,n){var r=t.series();t.series([].concat(e(r),[n])),Ge()}function Ye(e,t){var n=e.series();g(n,t),e.series(n),Ge()}ze.xScale(fe).yScale(me).series([Ie]);var Re=fc.chartCartesian(fe,me).webglPlotArea(ze).svgPlotArea(Ee).decorate((function(e){e.enter().call(P),e.enter().select(".svg-plot-area").call(A("border-bottom","1px solid rgba(0, 0, 0, 0.1)")),e.enter().selectAll(".x-axis").call(j),e.enter().selectAll(".top-label").call(j),e.enter().selectAll("svg").call(A("font-size","14px")),e.enter().selectAll(".plot-area").call(ge,fe)})),Xe=fc.chartCartesian({xScale:fe,yScale:Ve,yAxis:{right:function(e){return fc.axisRight(e).ticks(3)}}}).webglPlotArea(We).svgPlotArea(Be).decorate((function(e){e.enter().call(P),e.enter().selectAll(".plot-area").call(ge,fe),e.enter().selectAll(".x-axis").call(ge,fe),e.enter().selectAll(".top-label").call(j),e.enter().selectAll("svg").call(A("font-size","14px"))})),Ue=!1;function qe(){if(0!==V.length){var e=fe.invert(X.x),t=V.reduce((function(t,n){return Math.abs(n.date-e)<Math.abs(t.date-e)?n:t}));Ue&&function(e){var t=[me(e.open),me(e.high),me(e.low),me(e.close)].reduce((function(e,t){return Math.abs(t-X.y)<Math.abs(e-X.y)?t:e}));X.x=fe(e.date),X.y=t,Y.mode===z&&Ae(X.x,X.y)}(t),R.forEach((function(e){return e(t)})),Ke()}}function Ke(){d3.select("#ohlc-chart svg").datum([X]).call(be);var e=me.range()[0];d3.select("#volume-chart svg").datum([{x:X.x,y:X.y-e}]).call(be);var t=e+Ve.range()[0],n="#volume-chart";Y.additionalPanes.forEach((function(e){var r=e.id,a=e.yScale;d3.select("".concat(r," svg")).datum([{x:X.x,y:X.y-t}]).call(be),n=r,t+=a.range()[0]}));var r=null!=Y.currentBar?Y.currentBar.date.toLocaleString():"",a=d3.select("#x-label"),i=function(e){if("#ohlc-chart"===e)return me;if("#volume-chart"===e)return Ve;for(var t=0;t<Y.additionalPanes.length;t++){var n=Y.additionalPanes[t],r=n.id,a=n.yScale;if(e===r)return a}}(Y.currentPaneId),o=X.y-function(e){if("#ohlc-chart"===e)return 0;if("#volume-chart"===e)return me.range()[0];for(var t=me.range()[0]+Ve.range()[0],n=0;n<Y.additionalPanes.length;n++){var r=Y.additionalPanes[n],a=r.id,i=r.yScale;if(e===a)break;t+=i.range()[0]}return t}(Y.currentPaneId),l=y(i.invert(o)),c=d3.select("#y-label");if(X.x<0||X.y<0)return a.remove(),void c.remove();var s=function(e,t,n,a){var i=e.attr("id"),c="x-label"===i?"translate(".concat(X.x,",18)"):"translate(5,".concat(o,")");e.attr("transform",c),t.style("fill","white"),n.style("fill","black"),a.text("x-label"===i?r:l).style("fill","white");var s=a.node().getBBox();t.attr("x",s.x-5).attr("y",s.y-5).attr("width",s.width+10).attr("height",s.height+10),n.attr("x",s.x-5).attr("y",s.y-5).attr("width",s.width+10).attr("height",s.height+10),e.raise()};a.empty()?d3.select("".concat(n," .bottom-axis svg")).each((function(){var e=d3.select(this).append("g").attr("id","x-label"),t=e.append("rect").attr("id","rect1"),n=e.append("rect").attr("id","rect2"),r=e.append("text");s(e,t,n,r)})):a.each((function(){var e=d3.select(this),t=e.select("rect#rect1"),n=e.select("rect#rect2"),r=e.select("text");s(e,t,n,r)})),c.empty()?d3.select("".concat(Y.currentPaneId," .right-axis svg")).each((function(){var e=d3.select(this).append("g").attr("id","y-label"),t=e.append("rect").attr("id","rect1"),n=e.append("rect").attr("id","rect2"),r=e.append("text");s(e,t,n,r)})):c.each((function(){var e=d3.select(this),t=e.select("rect#rect1"),n=e.select("rect#rect2"),r=e.select("text");s(e,t,n,r)}))}document.addEventListener("keydown",(function(e){"Shift"===e.key&&(Ue=!0,qe())})),document.addEventListener("keyup",(function(e){"Shift"===e.key&&(Ue=!1,qe())}));var Ze=function(e){X.x=e.layerX;var t=fe.range()[1];e.layerX>t&&(X.x=t)};function Je(e){Y.currentPaneId!==e&&d3.select("#y-label").remove(),Y.currentPaneId=e}function Ge(){d3.select("#ohlc-chart").datum(V).call(Re),d3.select("#volume-chart").datum(V).call(Xe),Y.additionalPanes.forEach((function(e){var t=e.id,n=e.chart;d3.select(t).datum(V).call(n)})),Y.volumeVisible?D("#volume-chart"):N("#volume-chart"),Ke()}return d3.select("#ohlc-chart").on("mousemove",(function(e){Je("#ohlc-chart"),Ze(e),X.y=e.layerY,qe(),Y.mode===z?Ae(X.x,X.y):Y.mode===F&&function(e,t){if(Y.activeDrag){var n=0,r=0;Y.activeDrag.drawing.moreOpts.dragConstrainX||(n=e-Y.activeDrag.initialX),Y.activeDrag.drawing.moreOpts.dragConstrainY||(r=t-Y.activeDrag.initialY),Y.activeDrag.drawing.move(n,r)}}(X.x,X.y)})).on("mouseleave",(function(e){Y.mode===F&&Ne()})).on("click",(function(e){if(Y.mode===W)return t=X.x,n=X.y,r=fc.seriesSvgLine().xScale(fe).yScale(me).decorate((function(e){e.attr("stroke",Me)})),Fe(Ee,r),Y.activeLine={x1:fe.invert(t),y1:me.invert(n),chartObject:r},void U(z);var t,n,r;if(Y.mode===z){var a=fe.invert(X.x),i=me.invert(X.y);return De("",Y.activeLine.x1,Y.activeLine.y1,a,i,{draggable:!0}),void U(H)}for(var o=0;o<Y.drawings.length;o++)if(e.target.id.split("-")[0]===Y.drawings[o].id)return void(Y.mode===F?Te(e,Y.drawings[o]):Ne());Y.mode!==F||Ne()})).on("contextmenu",(function(e){e.preventDefault(),U(H)})),document.body.addEventListener("keypress",(function(){U(H)})),d3.select("#volume-chart").on("mousemove",(function(e){Je("#volume-chart"),Ze(e);var t=me.range()[0];X.y=e.layerY;var n=Ve.range()[0];e.layerY>n&&(X.y=n),X.y+=t,qe()})),R.forEach((function(e){0!==V.length&&e(V[V.length-1])})),Ge(),b.forEach((function(e,t){if("volume"!==e&&"ohlcBox"!==e){var n=s(l[t.iName]);n.iName=t.iName;var r=n.name;if(n.name=function(e){return r(e)+": "},t.options)for(var a in t.options)t.options.hasOwnProperty(a)&&(n.options[a]=t.options[a]);n.id=e,we(n)}})),{addTextDrawing:function(e,t,n){var r=document.querySelector("#ohlc-chart .plot-area svg");if(r){var a=document.createElementNS("http://www.w3.org/2000/svg","text");a.setAttributeNS(null,"x",fe(e)),a.setAttributeNS(null,"y",me(t)),a.style.textAnchor="middle",a.innerHTML=n,r.appendChild(a);var i={x:e,y:t,elem:a,remove:function(){g(Y.textDrawings,i),elem.remove()}};return Y.textDrawings.push(i),a}},addLineDrawing:De,refreshData:function(e,t){var n=!1,r=0;(function(e,t){if(e.length<2||t.length<0)return!1;var n=e[e.length-1].date.getTime();if(!(t[t.length-1].date.getTime()-n>=0))return!1;for(var r=t.length-1;r>0;r--)if(t[r].date.getTime()>=n&&t[r-1].date.getTime()<=n)return!0;return!1})(V,e)&&(n=!0,r=e[e.length-1].date.getTime()-V[V.length-1].date.getTime()),V=e.map((function(e,t,n){return I(e,t,n)})),!t&&n?function(e){var t=fe.domain();fe.domain([new Date(t[0].getTime()+e),new Date(t[1].getTime()+e)]),pe()}(r):ve(),ye(),He(),Y.indicators.forEach((function(e){var t=e.refreshDomain;t&&t()})),Ge()},setScaleExtent:function(e){ge.scaleExtent(e)}}}})();